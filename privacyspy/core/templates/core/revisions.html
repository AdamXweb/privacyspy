{% extends 'core/base.html' %}
{% load i18n %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'core/css/revisions.css' %}">
{% endblock %}

{% block content %}
    <h1 class="title is-size-1">Revision History</h1>
    <p class="subtitle is-size-4">{{object}}</p>
    <br>
    <div class="columns reverse-order-columns">
    <div class="column is-5">
    <div class="action-list-partial">
    {% load i18n l10n %}
    {% if compare_view %}<form method="GET" action="{{ action }}">{% endif %}
    <div class="compare-table">
        <table id="change-history" class="table is-fullwidth is-narrow">
            <thead>
                <tr>
                    {% if compare_view %}
                        <th scope="col">
                            {% trans 'Rev.' %}
                        </th>
                    {% endif %}
                    <th scope="col">{% trans 'Timestamp' %}</th>
                    <th scope="col">{% trans 'User' %}</th>
                </tr>
            </thead>
            <tbody>
                {% for action in action_list %}
                    <tr {% if version1.pk|unlocalize == action.version.pk|unlocalize or version2.pk|unlocalize == action.version.pk|unlocalize %}class="is-selected-mild"{% endif%}>
                        {% if compare_view %}
                        <td scope="row">
                            {% if comparable %}
                            <input type="radio" name="version_id1" value="{{ action.version.pk|unlocalize }}" {% if action.first %}style="visibility:hidden" {% endif %}{% if version1.pk|unlocalize == action.version.pk|unlocalize or action.second %}checked="checked"{% endif%}/>
                            <input type="radio" name="version_id2" value="{{ action.version.pk|unlocalize }}" {% if version2.pk|unlocalize == action.version.pk|unlocalize or action.first == 1 %}checked="checked"{% endif%}/>
                            {% else %}
                            <i>-</i>
                            {% endif %}
                        </td>
                        {% endif %}
                        <td>
                            {% if action.url %}
                                <a href="{{action.url}}">{{action.revision.date_created|date:_("DATETIME_FORMAT")}}</a>
                            {% else %}
                                {{action.revision.date_created|date:_("DATETIME_FORMAT")}}
                            {% endif %}
                        </td>
                        <td>
                            {% if action.revision.user %}
                                {{action.revision.user.username}}
                                {% if action.revision.user.first_name %} ({{action.revision.user.first_name}} {{action.revision.user.last_name}}){% endif %}
                            {% else %}
                            <i class="has-text-grey-light">Unattributed</i>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        <br>
        <button type="submit" class="button is-primary">Compare selected revisions</button>
        {% if compare_view %}</form>{% endif %}
    </div>
    </div>
    <div class="column is-7">
    <div class="compare-partial">
        {% for field_diff in compare_data %}
            <h3 class="heading">{% firstof field_diff.field.verbose_name field_diff.field.related_name %}</h3>
            {% if field_diff.field.help_text %}<p class="help">{{ field_diff.field.help_text }}</p>{% endif %}
            <div class="content">
                <p>{{ field_diff.diff }}</p>
            </div>
        {% endfor %}
    </div>
    <div class="compare-links-partial">
        {% if prev_url or next_url %}
        <hr>
        {% endif %}
        {% if prev_url %}<a href="{{ prev_url }}">&larr; {% trans "Previous revision" %}</a>{% endif %}
        {% if prev_url and next_url %}&bullet;{% endif %}
        {% if next_url %}<a href="{{ next_url }}">{% trans "Next revision" %} &rarr;</a>{% endif %}
    </div>
    </div>
    </div>
{% endblock %}